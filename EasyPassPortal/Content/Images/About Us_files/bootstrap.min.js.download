(()=>{function ob(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function Fa(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function Z(a){if(a)for(const b of Object.keys(JSON.parse(a)))if(!r.hasOwnProperty(b))return b}function ma(){if(embeddedservice_bootstrap.isLocalStorageAvailable)return Z(localStorage.getItem(m)||"{}");if(embeddedservice_bootstrap.isSessionStorageAvailable)return Z(sessionStorage.getItem(m)||
"{}")}function Ga(){let a,b;if(ma())n=ma(),l("initializeWebStorage",`Retreived existing conversation-id: ${n} from web storage`);else{var c=new Uint32Array(32);crypto.getRandomValues(c);let d="";for(let e=0;32>e;e++){if(8===e||12===e||16===e||20===e)d+="-";d=12===e?d+"4":16===e?d+"0123456789abcdef".charAt(c[e]&3|8):d+"0123456789abcdef".charAt(c[e]&15)}n=d;l("initializeWebStorage",`Generated a new conversation-id: ${n}`)}c=JSON.stringify({[n]:{}});embeddedservice_bootstrap.isLocalStorageAvailable&&
!localStorage.getItem(m)&&(a=c,localStorage.setItem(m,a));embeddedservice_bootstrap.isSessionStorageAvailable&&!sessionStorage.getItem(m)&&(b=c,sessionStorage.setItem(m,b));(a||b)&&aa("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});l("initializeWebStorage","web storage initialized")}function E(a,b=!0){if(b=Fa(b)){var c=b.getItem(m)&&JSON.parse(b.getItem(m))||{};c=a===r.JWT?c[a]:c[n]&&c[n][a]}return c}function Ha(a,b){if(b&&
a){const c=b.getItem(m)&&JSON.parse(b.getItem(m))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(m,JSON.stringify(c))}}function K(a,b,c=!0,d=!1){const e=Fa(c);if(e){const k=e.getItem(m)&&JSON.parse(e.getItem(m))||{};a===r.JWT?k[a]=b:(k[n]||(k[n]={}),k[n][a]=b);e.setItem(m,JSON.stringify(k));l("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&aa("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,conversationId:n,
key:a,value:b,inLocalStorage:c})}}function na(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&localStorage.removeItem(m);embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(m);aa("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);l("clearWebStorage","web storage cleared")}function pb(){C=void 0;oa=new Promise(a=>{pa=a});z={};F={};D=void 0;I=A=!1;Ia();Ja();qb();l("clearInMemoryData","Cleared in-memory data.")}function Ka(a,b){if(n!==a){if(embeddedservice_bootstrap.isSessionStorageAvailable){const c=
sessionStorage.getItem(m)?JSON.parse(sessionStorage.getItem(m)):{};c[n]?(c[a]=c[n],delete c[n]):c[a]={};sessionStorage.setItem(m,JSON.stringify(c));l("updateConversationIdInWebStorage","conversationId updated in sessionStorage")}if(embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.isLocalStorageAvailable&&!b:embeddedservice_bootstrap.isLocalStorageAvailable)b=localStorage.getItem(m)?JSON.parse(localStorage.getItem(m)):{},b[n]?(b[a]=b[n],delete b[n]):b[a]=
{},localStorage.setItem(m,JSON.stringify(b)),l("updateConversationIdInWebStorage","conversationId updated in localStorage");n=a}}function La(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,a)}function P(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+(Array.isArray(b)?b.join(", "):
b))}function l(a,b,c){P("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:n,convType:u(),hostUrl:window.location.href});qa(c)}function p(a,b){a?P("warn","Warning: "+a,b):P("warn","EmbeddedServiceBootstrap sent an anonymous warning.",b)}function h(a,b,c,d){b?P("error",b,d):P("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},
{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:""},c&&{errCode:c},{convId:n,convType:u(),hostUrl:window.location.href}));qa(null,d)}function ra(){return window.$A&&"function"===typeof window.$A.get&&window.$A.get("$Site")}function sa(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(k=>{sa(d,k.type,k)}):d.setAttribute(e,
c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}function ta(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{sa(b,c.type,c)}):sa(b,"path",{d:a}),b;h("renderSVG","Invalid icon data.")}function rb(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&p("EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function ba(a){"string"!==typeof a?h("setAndStoreJwt",`Expected to receive string, instead received: ${a}.`):
(C=a,K(r.JWT,C))}function Ma(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.contentWindow===a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":Na(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":Na(!1);break;default:p("Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":Oa();
break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&a.data.data.localStorage&&Ha(a.data.data.localStorage,localStorage);a.data.data&&a.data.data.sessionStorage&&Ha(a.data.data.sessionStorage,sessionStorage);Pa();break;default:p("Unrecognized event name: "+a.data.method)}else if(0===B().indexOf(a.origin)&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)&&v().contentWindow===a.source){var b=v();switch(a.data.method){case "ESW_APP_READY_EVENT":pa();break;case "ESW_APP_LOADED":a=
w();b=document.getElementById("embeddedMessagingIconContainer");let c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingLoadingSpinner");v()||p("Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):p("Embedded Messaging static button not available for post-app-load updates.");
Qa();I=!0;try{G("onEmbeddedMessagingInitSuccess")}catch(e){I=!1,h("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;case "ESW_APP_INITIALIZATION_ERROR":ca();break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b);break;case "ESW_APP_RESET_INITIAL_STATE":L();break;case "ESW_SET_JWT_EVENT":ba(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":na();
break;case "ESW_DOWNLOAD_FILE":sb(a.data.data);break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?h("storeFailedMessagesInWebStorage",`Expected to receive object, instead received: ${a}.`):K(r.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=r.FAILED_OUTBOUND_MESSAGE_ENTRIES;embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(m)&&(b=JSON.parse(localStorage.getItem(m))||{},delete b[a],b[n]&&b[n][a]&&
delete b[n][a],localStorage.setItem(m,JSON.stringify(b)));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(m)&&(b=JSON.parse(sessionStorage.getItem(m))||{},delete b[a],b[n]&&b[n][a]&&delete b[n][a],sessionStorage.setItem(m,JSON.stringify(b)));l("removeItemInWebStorage",`${a} removed from web storage`);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":Ia(a.data.data);break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":q("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",z);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":q("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",
F);break;case "EMBEDDED_MESSAGING_CONVERSATION_ID_UPDATE":Ka(a.data.data,!1);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":u()!==x.AUTH?p("handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):G("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":Ra();break;case "ESW_APP_PRECHAT_SUBMIT":tb(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=v())&&a.classList.add("hasMinimizedNotification");
break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":ub();break;default:p("Unrecognized event name: "+a.data.method)}}else h("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function Sa(a){if(a&&a.key&&a.key===m)if(null===a.newValue)u()===x.AUTH&&ua(!1,!0);else{const b=Z(a.oldValue);a=Z(a.newValue);b&&a&&b!==a&&(l("handleStorageEvent","ConversationId change detected in web storage"),Ka(a,!0))}}function ca(){I=!0;try{qa(),G("onEmbeddedMessagingInitError")}catch(a){I=!1,h("emitEmbeddedMessagingInitErrorEvent",
`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}function G(a){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);try{window.dispatchEvent(new CustomEvent(a))}catch(b){throw Error("Something went wrong while dispatching the event "+a+":"+b);}}function Ia(a){if(a){const b=JSON.parse(a)[0],c=Ta;Q&&window.clearInterval(Q);Q=window.setInterval(()=>{document.title=document.title===b?c:b},1E3)}else window.clearInterval(Q),Q=void 0,
document.title=Ta}function v(){return document.getElementById("embeddedMessagingFrame")}function w(){return document.getElementById("embeddedMessagingConversationButton")}function Na(a){const b=v();embeddedservice_bootstrap.filePreviewFrame&&b&&(a?(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden",
"true")):(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false")),l("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`))}function sb(a){let b;if(!ob(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);b=document.createElement("iframe");b.style.display="none";b.src=a.attachmentDownloadURL||
"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function Ua(a){return new Promise((b,c)=>{let d=B(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=b;document.getElementsByTagName("head")[0].appendChild(e)})}
function Va(){return Wa(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function va(){return Wa(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,
"GET","getBusinessHoursInterval").then(a=>{a=a&&a.businessHoursInfo;l("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(R()||"boolean"!==typeof embeddedservice_bootstrap.settings.hideChatButtonOnLoad)&&(H={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},wa())}).catch(a=>{throw a;})}function Xa(a){h("handleBusinessHoursError","Failed to retrieve Business Hours data. Retrying the request.",
a);return va()}function Wa(a,b,c){const d=performance.now();return new Promise((e,k)=>{const f=new XMLHttpRequest;f.open(b,a,!0);f.onreadystatechange=g=>{if((g=g.target)&&g.readyState===g.DONE||204===g.status){const J=((performance.now()-d)/1E3).toFixed(3);if(200===g.status||204===g.status){const xa=g.responseText?JSON.parse(g.responseText):g.responseText;e(xa)}else k(g.status);l("sendXhrRequest",`${c?c:a} took ${J} seconds and returned with the status code ${g.status}`)}};f.send()})}function vb(){return u()===
x.AUTH?Ya().then(a=>Za().then(b=>{l("initializeConversationState","finished joining verified user conversation");da(a,b)}).catch(()=>{ca()})):u()===x.UNAUTH?$a()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(da(),Promise.resolve()):ya().then(a=>ea(z).then(b=>{l("initializeConversationState","finished creating conversation");da(a,b)}).catch(()=>{ca()})):Promise.reject(Error("Something went wrong initializing conversation state."))}function da(a,
b,c=!1){var d=E(r.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const e=embeddedservice_bootstrap.settings.standardLabels,k=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var f=embeddedservice_bootstrap.settings.imageCompressionOptions;f=Object.assign({},f.quality&&!isNaN(Number(f.quality))&&0<=Number(f.quality)&&1>=Number(f.quality)&&{quality:Number(f.quality)},f.maxHeight&&!isNaN(Number(f.maxHeight))&&0<Number(f.maxHeight)&&
{maxHeight:Number(f.maxHeight)},f.maxWidth&&!isNaN(Number(f.maxWidth))&&0<Number(f.maxWidth)&&{maxWidth:Number(f.maxWidth)},f.convertTypes&&("string"===typeof f.convertTypes||Array.isArray(f.convertTypes))&&{convertTypes:f.convertTypes},f.convertSize&&!isNaN(Number(f.convertSize))&&0<=Number(f.convertSize)&&{convertSize:f.convertSize})}d=Object.assign({},embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},{identityToken:D,failedMessages:d,conversationId:n,devMode:!!embeddedservice_bootstrap.settings.devMode,
language:embeddedservice_bootstrap.settings.language,imageCompressionOptions:f},e&&{standardLabels:e},k&&{customLabels:k},{hasConversationButtonColorContrastMetA11yThreshold:ab.isValidContrastRatio("#FFFFFF",M("headerColor")),hostUrl:window.location.href},"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},{restrictSessionOnMessagingChannel:embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel,
shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab}))||{};a&&(d=Object.assign(d,{jwtData:a}));b&&(d=Object.assign(d,{conversationData:b}));d.isExistingSessionOnPageLoad=c;q("ESW_SET_CONFIG_EVENT",d)}function tb(a){const b=Object.assign(a,z);u()===x.AUTH?ea(b).then(c=>{q("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",c)}):u()===x.UNAUTH&&ya().then(c=>{q("ESW_SET_JWT_EVENT",c);ea(b).then(d=>{q("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})}function bb(){return new Promise(a=>
{embeddedservice_bootstrap.createFilePreviewFrame();embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function wb(){return E(r.JWT)?xb().then(a=>{ba(a.accessToken);l("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>{h("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);L()}):Promise.reject(void 0)}function xb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");
return N(a,"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function ya(){return yb().then(a=>{ba(a.accessToken);l("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>zb(a))}function yb(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName;var c=cb();c=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",
c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");return N(c,"POST","cors",{"Content-Type":"application/json"},{orgId:a,developerName:b,capabilitiesVersion:"248"},"getUnauthenticatedJwt").then(d=>{if(!d.ok)throw d;return d.json()})}function Ya(){return Ab().then(a=>{ba(a.accessToken);l("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{h("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a&&
a.message?a.message:a}.`);Ra()})}function Ab(){const a=embeddedservice_bootstrap.settings.orgId,b=embeddedservice_bootstrap.settings.eswConfigDevName,c=D,d=cb(),e=d?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken","?",d):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),k={"Content-Type":"application/json"},f={orgId:a,developerName:b,capabilitiesVersion:"248",authorizationType:za.JWT,
customerIdentityToken:c};return c&&fa(c)?S(e,"POST","cors",k,f,"getAuthenticatedJwt").then(g=>{if(!g.ok)throw g;return g.json()}).catch(g=>ha(g,e,"POST","cors",k,f,"getAuthenticatedJwt")):(new Promise(g=>{db({apiPath:e,method:"POST",mode:"cors",requestHeaders:k,requestBody:f,resolve:g})})).then(g=>{if(!g.ok)throw g;return g.json()})}function Bb(){Cb().then(()=>{l("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}function Cb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");
return N(a,"POST","cors",null,{},"registerDeviceCapabilities")}function Za(a){return Db(!1,embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw b=ma(),l("handleListConversation",
`No open conversation found, deleting stale data with conversationId: ${b} from web storage`,!0),p("No open conversation found, deleting stale data with conversationId "+b+" from web storage"),L(),Error(`Invalid conversation identifier: ${b}.`);return $a()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(l("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),p("No existing conversation found and pre-chat is not enabled. Will start a new conversation."),
ea(z).then(d=>d))}1<c.length&&(l("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),p(`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),c.sort((d,e)=>e.startTimestamp-d.startTimestamp));b=c[0];if(!Eb(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);
l("handleListConversation","Successfully retrieved existing conversation");b.isExistingConversation=!0;return b}).catch(b=>{h("handleListConversation",`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);})}function Db(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return N(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},
b&&{channelAddressIdentifier:b}),"listConversation").then(d=>d.json())}function zb(a){if(a&&a.status&&401===a.status)return h("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",a.status),ya().catch(b=>{throw Error(b);});throw Error(`Error retrieving unauthenticated token: ${a}.`);}function $a(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}
function ea(a){return Fb(a).then(b=>{Bb();return b})}function Fb(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation");return N(b,"POST","cors",null,Object.assign({},a&&{routingAttributes:a},{conversationId:n}),"createNewConversation").then(c=>c.json())}function Gb(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation","/",n,"/transcript");return N(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}function ub(){Gb().then(a=>
{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);q("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT")}).catch(a=>{a?a.json().then(b=>{const c=a.status;b=b?b.message:void 0;q("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{errorCode:c,errorMessage:b}});h("handleRequestTranscript",`Transcript request failed with status code: ${c} & message: ${b}`,
c)}):q("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{}})})}function S(a,b,c,d,e,k=a){d=d?d:Object.assign({},{"Content-Type":"application/json"},C&&{Authorization:"Bearer "+C});e=e?JSON.stringify(e):void 0;const f=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},e&&{body:e})).then(g=>{const J=((performance.now()-f)/1E3).toFixed(3);l("sendFetchRequest",`${k} took ${J} seconds and returned with the status code ${g.status}`);401===g.status&&na();if(!g.ok)throw g;
return g})}function ha(a,b,c,d,e,k,f=b){if(!a||!a.status||500<=a.status&&599>=a.status)return h("handleSendFetchRequestError",`Something went wrong in ${f}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),S(b,c,d,e,k,f).catch(g=>{h("handleSendFetchRequestError",`${f} request failed again: ${g&&g.message?g.message:JSON.stringify(Object.assign({},g,{status:g.status,statusText:g.statusText,type:g.type}))}.`,
g&&g.status);throw g;});h("handleSendFetchRequestError",`Something went wrong in ${f}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status);throw a;}function N(a,b,c,d,e,k){return u()===x.AUTH?C&&fa(C)?S(a,b,c,d,e,k).catch(f=>ha(f,a,b,c,d,e,k)):D&&fa(D)?new Promise(f=>{eb({apiPath:a,method:b,mode:c,requestHeaders:d,requestBody:e,resolve:f})}):new Promise(f=>{db({apiPath:a,method:b,mode:c,requestHeaders:d,requestBody:e,resolve:f})}):
S(a,b,c,d,e,k).catch(f=>ha(f,a,b,c,d,e,k))}function cb(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" ");const b=fb(a,[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},
{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=fb(a,[{name:"Edge",value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",
version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return(new URLSearchParams({os:b.name,osVersion:b.version,browser:a.name,browserVersion:a.version})).toString()}function fb(a,b){let c;let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=1)d=0===a?d+(e[a]+"."):d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",
version:0}}function B(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){h("getSiteURL",`Error getting Site URL: ${a}`)}}function y(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";return""}function M(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&
b.n===a)return b.v}function Hb(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?h("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",b[1].trim()))}}function gb(){let a=w(),b=document.getElementById("embeddedMessagingIconContainer"),
c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e,k=1;if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingLoadingSpinner");for(d.setAttribute("id","embeddedMessagingLoadingSpinner");13>k;k++)e=document.createElement("div"),e.setAttribute("class","embeddedMessagingLoadingCircle"+k+" embeddedMessagingLoadingCircle"),d.appendChild(e);d.classList.add("embeddedMessagingIconLoading");a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,
c);a.disabled=!0}}function hb(){if(!H)return!0;const a=Number(H.startTime),b=Number(H.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function wa(){let a;if(H){var b=hb();b?a=Number(H.endTime):(a=Number(H.startTime),G("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(T&&clearTimeout(T),T=setTimeout(()=>{clearTimeout(T);T=void 0;Ib(b);b?G("onEmbeddedMessagingBusinessHoursEnded"):G("onEmbeddedMessagingBusinessHoursStarted")},a-Date.now()))}}function Ib(a){a?(H=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),
va().then(wa()).catch(b=>Xa(b))):(R()||embeddedservice_bootstrap.utilAPI.showChatButton(),wa())}function Jb(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function R(){try{return embedded_svc&&embedded_svc.menu?!0:!1}catch(a){return!1}}function Aa(a){const b=embeddedservice_bootstrap.settings.targetElement.children;
let c;for(const d in b)c=b[d],c!==document.getElementById("embedded-messaging")&&c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function ib(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",U),U=void 0)}function q(a,b){oa.then(()=>{const c=v();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),
B()):p(`Embedded Messaging iframe not available for post message with method ${a}.`)})}function aa(a,b){Kb.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),B()):p(`Embedded Messaging iframe not available for post message with method ${a}.`)})}function Lb(a){a||h("handleAuraSite","Failed to load aura app. Iframe is undefined.");
a.src=B()+"/embeddedService/embeddedService.app"}function Mb(a){let b=B();a||h("handleLWRSite","Failed to load LWR site. Iframe is undefined.");b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function Ba(){return new Promise((a,b)=>{try{let c=w(),d=v();c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")?(gb(),l("handleClick","Conversation button clicked"),bb().then(()=>{a()}).catch(e=>{h("handleClick",e.message);b(e)}),vb().catch(e=>
{ca();h("handleClick",e.message);b(e)})):c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&d&&d.classList&&d.classList.contains("isMaximized")?q("ESW_APP_MINIMIZE"):h("handleClick","Something went wrong handling button click event.")}catch(c){b(c)}})}function Nb(a){let b=v();a&&a.key&&(a.key===V.SPACE||a.key===V.ENTER?(a.preventDefault(),Ba()):a.key===V.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),q("trapfocustolast")))}function Ob(){const a=
document.getElementById("embeddedMessagingMinimizedNotification"),b=w();a&&a.parentNode.removeChild(a);b&&b.focus()}function Pb(a){if(a.key===V.ENTER||a.key===V.SPACE)a.preventDefault(),this.handleNotificationDimissButtonClick()}function Qb(){if(E(r.JWT))return gb(),bb().catch(h),wb().then(a=>{Za(!0).then(b=>{da(a,b,!0)})}).catch(h)}function L(a){try{na(a),pb(),Ga()}catch(b){h("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${b}`)}W&&"function"===
typeof W&&(W(),W=void 0);U&&ib();Ca.test(navigator.userAgent)&&Aa(!1);embeddedservice_bootstrap.removeMarkup();u()===x.UNAUTH&&embeddedservice_bootstrap.generateMarkup();l("resetClientToInitialState","Client reset to initial state")}function Rb(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}function qa(a,b){a&&ia.currentStateLogs.push(a);b&&ia.errorLogs.push(b);oa.then(()=>{q("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:ia});Ja()})}function Ja(){ia=
{currentStateLogs:[],errorLogs:[]}}function Da(){}function ua(a,b){v()?q("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",a):L(b)}function eb(a){return new Promise(b=>{l("renewAuthenticatedJwt","Renewing Authenticated JWT");Ya().then(()=>{jb(a);b()})})}function jb(a){a&&S(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&a.resolve(b)}).catch(b=>ha(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function db(a){if(a){G("onEmbeddedMessagingIdentityTokenExpired");
var b=new Promise(d=>{X=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{l("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");a.apiPath.includes("/accessToken")?(a.requestBody.customerIdentityToken=D,jb(a)):eb(a)}).catch(()=>{h("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");ua(!1,!1)})}}function Ra(){let a;L(!1);embeddedservice_bootstrap.generateMarkup();
a=w();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");if(a){a.style.display="block";a.setAttribute("tabindex",-1);a.style.setProperty("cursor","default");a.classList.add("no-hover");c&&b&&c.removeChild(b);b=ta(ja.REFRESH);b.setAttribute("id","embeddedMessagingIconRefresh");b.setAttribute("class","embeddedMessagingIconRefresh");c.appendChild(b);c=document.createElement("div");b=document.createElement("div");const e=document.createElement("span"),
k=document.createElement("span");var d=document.createElement("button");const f=document.createElement("span"),g=document.createElement("span");d.className="embeddedMessagingMinimizedNotificationDismissButton";d.addEventListener("click",Ob);d.addEventListener("keydown",Pb);d.setAttribute("aria-describedby","dismissButton-help");f.className="embeddedMessagingMinimizedNotificationDismissButtonText";f.title=y("EmbeddedMessagingMinimizedState","NotificationDismissButtonText")||"Dismiss";f.innerHTML=y("EmbeddedMessagingMinimizedState",
"NotificationDismissButtonText")||"Dismiss";f.style.setProperty("font-family",M("font"));g.className="slds-assistive-text";g.id="dismissButton-help";g.innerHTML=y("EmbeddedMessagingMinimizedState","MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";d.appendChild(f);d.appendChild(g);c.id="embeddedMessagingMinimizedNotification";c.className="embeddedMessagingMinimizedNotification";b.className="embeddedMessagingMinimizedNotificationTextWrapper";e.className="embeddedMessagingMinimizedNotificationText";
e.role="status";e.title=y("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.innerHTML=y("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation.";e.style.setProperty("font-family",M("font"));k.className="slds-assistive-text";k.innerHTML=y("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";
b.appendChild(e);b.appendChild(k);c.appendChild(b);c.appendChild(d);a.disabled=!0;embeddedservice_bootstrap.settings.targetElement.appendChild(c)}}function kb(a){a=a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}function fa(a){let b,c;try{return b=kb(a),c=Math.floor(Date.now()/1E3)<b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&l("validateJwt",
`JWT has expired at ${(new Date(1E3*b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&h("validateJwt",`JWT validation failed: ${d.message}`),!1}}function u(){let a=null;try{a=embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){h("getAuthMode",`Failed to retrieve auth mode flag: ${b.message}`)}return a}
function Y(){z=E(r.HIDDEN_PRECHAT_FIELDS,!1)||{}}function lb(a,b,c,d){const e="setHiddenPrechatFields"===a;var k=e?Sb():O();const f=k.map(({name:g})=>g);k=k.find(g=>g.name===b);if(!f.includes(b))return h("validatePrechatField",`${a} called with an invalid field name ${b}.`),!1;if("string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>")))return h("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),!1;if(e){if(c.length>
k.maxLength)return h("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${k.maxLength} characters.`),!1;if("string"!==typeof c)return h("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),!1}return d&&"boolean"!==typeof d?(h("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),!1):!0}function Sb(){let a=
[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function O(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&
Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:[]}function ka(a){return A?!0:(h("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function Eb(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function qb(){O().forEach(a=>{delete a.value;
delete a.isEditableByEndUser})}function Ea(){F=E(r.AUTORESPONSE_PARAMETERS,!1)||{}}function mb(a){return A?!0:(h("shouldProcessAutoResponseParametersFromHost",`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),!1)}function la(){}function t(){this.settings={devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(ja,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},REFRESH:{value:"M46.5,4h-3C42.7,4,42,4.7,42,5.5v7c0,0.9-0.5,1.3-1.2,0.7l0,0c-0.3-0.4-0.6-0.7-1-1c-5-5-12-7.1-19.2-5.7 c-2.5,0.5-4.9,1.5-7,2.9c-6.1,4-9.6,10.5-9.7,17.5c-0.1,5.4,2,10.8,5.8,14.7c4,4.2,9.4,6.5,15.2,6.5c5.1,0,9.9-1.8,13.7-5 c0.7-0.6,0.7-1.6,0.1-2.2l-2.1-2.1c-0.5-0.5-1.4-0.6-2-0.1c-3.6,3-8.5,4.2-13.4,3c-1.3-0.3-2.6-0.9-3.8-1.6 C11.7,36.6,9,30,10.6,23.4c0.3-1.3,0.9-2.6,1.6-3.8C15,14.7,19.9,12,25.1,12c4,0,7.8,1.6,10.6,4.4c0.5,0.4,0.9,0.9,1.2,1.4 c0.3,0.8-0.4,1.2-1.3,1.2h-7c-0.8,0-1.5,0.7-1.5,1.5v3.1c0,0.8,0.6,1.4,1.4,1.4h18.3c0.7,0,1.3-0.6,1.3-1.3V5.5 C48,4.7,47.3,4,46.5,4z"}});
this.brandingData=[]}function Tb(){const a=document.createElement("iframe"),b=`${B()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html?parent_domain=${window.location.origin}`;a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b;a.onload=()=>{l("createSiteContextFrame","Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}
const ja={};class ab{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=
parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}}const Ub=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .w.crm.dev".split(" "),za={JWT:"JWT"},Ta=document.title;let Q,A=!1,I=!1,z={},F={},C,D,m,n,pa,oa=new Promise(a=>{pa=a}),Oa;const Kb=new Promise(a=>{Oa=a});let Pa,Vb=new Promise(a=>{Pa=a}),U,H,T;const r={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",HIDDEN_PRECHAT_FIELDS:"HIDDEN_PRECHAT_FIELDS",AUTORESPONSE_PARAMETERS:"AUTORESPONSE_PARAMETERS"},
V={ENTER:"Enter",TAB:"Tab",SPACE:" "},Ca=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i;let W,X,ia={currentStateLogs:[],errorLogs:[]},Qa,nb=new Promise(a=>{Qa=a});t.prototype.removeEventHandlers=function(){window.removeEventListener("message",
Ma);window.removeEventListener("storage",Sa)};t.prototype.emitEmbeddedMessagingReadyEvent=function(){A=!0;try{G("onEmbeddedMessagingReady")}catch(a){A=!1,h("emitEmbeddedMessagingReadyEvent",`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};t.prototype.removeMarkup=function(a){const b=v(),c=w(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingMinimizedNotification"),k=document.getElementById("embedded-messaging"),f=document.getElementById("inert-script");
b?b.parentNode.removeChild(b):p("Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):p("Embedded Messaging file preview iframe not available for resetting the client to initial state.");a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?
embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):p("Embedded Messaging site context iframe not available for resetting the client to initial state.");d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));
c?c.parentNode.removeChild(c):p("Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);k&&k.parentNode.removeChild(k);f&&f.parentNode.removeChild(f);embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent()};const x={AUTH:"Auth",UNAUTH:"UnAuth"};Da.prototype.setIdentityToken=function(a){let b;if(!A)return h("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(u()!==x.AUTH)return h("setIdentityToken",
"User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return h("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||b.trim().toUpperCase()!==za.JWT)return h("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),!1;let c=!1;switch(b){case za.JWT:c=fa(a)}if(!c)return h("setIdentityToken",
"Invalid identity token passed into the setIdentityToken method."),!1;D=a;X&&"function"===typeof X&&(X(),X=void 0);v()?q("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",D):w()?w()&&document.getElementById("embeddedMessagingIconRefresh")&&(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};Da.prototype.clearSession=function(){return new Promise((a,b)=>{W=a;A?ua(u()===x.AUTH,!1):(b("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),
h("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};Y.prototype.setHiddenPrechatFields=function(a){if(ka("setHiddenPrechatFields"))if(a&&"object"===typeof a)for(const [b,c]of Object.entries(a))lb("setHiddenPrechatFields",b,c)&&(z[b]=c,K(r.HIDDEN_PRECHAT_FIELDS,z,!1,!0),l("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));else h("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};
Y.prototype.removeHiddenPrechatFields=function(a){ka("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){z.hasOwnProperty(b)?(delete z[b],K(r.HIDDEN_PRECHAT_FIELDS,z,!1,!0),l("removeHiddenPrechatFields",`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):h("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):h("removeHiddenPrechatFields","When calling removeHiddenPrechatFields, you must pass in an array of fields."))};
Y.prototype.setVisiblePrechatFields=function(a){if(ka("setVisiblePrechatFields")){var b=O();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,d]of a)if(lb("setVisiblePrechatFields",c,d.value,d.isEditableByEndUser)){const e=b.find(k=>k.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);l("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&nb.then(()=>
{q("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",O())})}else h("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};Y.prototype.unsetVisiblePrechatFields=function(a){if(ka("unsetVisiblePrechatFields")){var b=O();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,l("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):
h("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),nb.then(()=>{q("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",O())})):h("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};Ea.prototype.setAutoResponseParameters=function(a){if(mb("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||
1>a.trim().length?(h("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(h("validateAutoResponseParameter",`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(F[c]=d,K(r.AUTORESPONSE_PARAMETERS,F,!1,!0),l("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):p(`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else h("setAutoResponseParameters",
"[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};Ea.prototype.removeAutoResponseParameters=function(a){mb("removeAutoResponseParameters")&&(a&&Array.isArray(a)?a.forEach(function(b){F.hasOwnProperty(b)?(delete F[b],K(r.AUTORESPONSE_PARAMETERS,F,!1),l("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):p(`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):h("removeAutoResponseParameters",
"[removeAutoResponseParameters] Must pass in an array of parameter names."))};la.prototype.showChatButton=function(){var a=u();if(!A)return h("showChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===x.UNAUTH||D){if(a=w())return a.style.display="block",!0}else h("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};la.prototype.hideChatButton=function(){if(!A)return h("hideChatButton",
"Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(v())h("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");else{const a=w();if(a)return a.style.display="none",!0}return!1};la.prototype.launchChat=function(a=!1){return new Promise((b,c)=>{let d;const e=()=>{let f;I?(f="[Launch Chat API] Successfully initialized the messaging client.",l("launchChat",f),b(f),window.removeEventListener("onEmbeddedMessagingInitSuccess",e),window.removeEventListener("onEmbeddedMessagingInitError",
k)):(f="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",p(f),c(f))},k=()=>{let f;I?(f="[Launch Chat API] Error launching the messaging client.",h("handleBootstrapError",f),c(f),window.removeEventListener("onEmbeddedMessagingInitSuccess",e),window.removeEventListener("onEmbeddedMessagingInitError",k),L()):(f="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",p(f),c(f))};try{if(A){if(!w())if(R())u()===
x.UNAUTH&&embeddedservice_bootstrap.generateMarkup(!0);else{d="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";p(d);c(d);return}if(v()){let f=v();a&&f&&f.classList&&f.classList.contains("isMinimized")?(q("ESW_APP_MAXIMIZE"),l("launchChat","[Launch Chat API] Successfully maximized the messaging client."),b("[Launch Chat API] Successfully maximized the messaging client.")):(d=`[Launch Chat API] The messaging client window is already present${a?
" & maximized.":"."}`,l("launchChat",d),p(d),b(d))}else window.addEventListener("onEmbeddedMessagingInitSuccess",e),window.addEventListener("onEmbeddedMessagingInitError",k),Ba().catch(f=>{d=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${f}`;h("launchChat",d);c(d)})}else d="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",p(d),c(d)}catch(f){d=`[Launch Chat API] Something went wrong launching the API: ${f}`,h("launchChat",
d),c(d)}})};t.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};t.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,3)};t.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};t.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//","");if(ra()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};
return Ub.some(function(d){return c(b,d)})};t.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),c=document.getElementById("embedded-messaging"),d=w();if(!R()||a)if(!c||!d){c=document.createElement("div");c.id="embedded-messaging";c.className="embedded-messaging";a=document.createElement("div");d=document.createElement("button");ab.isValidContrastRatio("#FFFFFF",M("headerColor"))||document.documentElement.style.setProperty("--eswIconFillColor","#1A1B1E");var e=document.createElement("div");
const k=ta(ja.CHAT);k.setAttribute("id","embeddedMessagingIconChat");k.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(k);a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",Ba);d.addEventListener("keydown",Nb);d.setAttribute("tabindex",0);d.setAttribute("role",
"button");d.setAttribute("aria-label",y("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",y("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswHeaderColor",M("headerColor"));d.style.setProperty("--eswSecondaryColor",M("secondaryColor"));embeddedservice_bootstrap.settings.hasBottomTabBar&&d.classList.add("embeddedMessagingBottomTabBar");("boolean"===
typeof embeddedservice_bootstrap.settings.hideChatButtonOnLoad?embeddedservice_bootstrap.settings.hideChatButtonOnLoad:R()||!hb())&&!E(r.JWT)&&(d.style.display="none");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());(void 0!==window.LWR||ra())&&d.classList.add("experienceSite");d.appendChild(e);
a.appendChild(d);d=a;b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);document.getElementById("inert-script")||(b=document.createElement("script"),c=`${B()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b))}};t.prototype.createFilePreviewFrame=function(){const a=document.createElement("iframe"),b=`${B()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?
"":".min"}.html?parent_domain=${window.location.origin}`;a.classList.add("embeddedMessagingFilePreviewFrame");a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";a.src=b;a.title=y("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{l("createFilePreviewFrame","Created an iframe for file preview.")};embeddedservice_bootstrap.filePreviewFrame=a;document.body.appendChild(a)};t.prototype.createIframe=function(){return new Promise((a,
b)=>{try{const c=document.getElementById("embedded-messaging"),d=document.createElement("iframe"),e=Rb();d.title=y("EmbeddedMessagingIframesAndContents","MessagingIframeTitle")||"Chat with an Agent";d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";d.allowTransparency="true";d.setAttribute("aria-label",y("EmbeddedMessagingChatHeader","ChatWindowAssistiveText")||"Chat Window");embeddedservice_bootstrap.settings.omitSandbox||
(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");embeddedservice_bootstrap.settings.isAuraSite?Lb(d):Mb(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));navigator.userAgent.includes("CommunityHybridContainer")||navigator.userAgent.includes("playgroundcommunity")?d.classList.add("mobilePublisher"):
(void 0!==window.LWR||ra())&&d.classList.add("experienceSite");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());d.onload=()=>{l("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};t.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+
a);}};t.prototype.maximizeIframe=function(a){const b=w();var c=document.getElementById("embeddedMessagingModalOverlay");const d=document.getElementById("embeddedMessagingIconChat"),e=document.getElementById("embeddedMessagingIconContainer"),k=document.querySelector('meta[name="viewport"]'),f=!!navigator.userAgent.match(/iP(hone|ad|od)/i);a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&
(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")));b&&(b.style.display="block",b.setAttribute("tabindex",-1),b.setAttribute("aria-label",y("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),b.setAttribute("title",y("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),d.style.display="none",document.getElementById("embeddedMessagingIconMinimize")||
(a=ta(ja.MINIMIZE_MODAL),a.setAttribute("id","embeddedMessagingIconMinimize"),a.setAttribute("class","embeddedMessagingIconMinimize"),e.insertBefore(a,d)));c&&!c.classList.contains("isMaximized")&&c.classList.add("isMaximized");-1===navigator.userAgent.indexOf("Mobi")||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(c=document.documentElement.getBoundingClientRect(),
embeddedservice_bootstrap.documentScrollPosition=Math.abs(c.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));f&&k&&(U=k.content,k.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1"));Ca.test(navigator.userAgent)&&Aa(!0);q("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");l("maximizeIframe","Maximized the app")};t.prototype.minimizeIframe=function(a,b){const c=w(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");
b=b.hasMinimizedNotification;a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));
d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");-1!==navigator.userAgent.indexOf("Mobi")&&(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));U&&ib();Ca.test(navigator.userAgent)&&Aa(!1);q("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");l("minimizeIframe","Minimized the app")};t.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=
new Y;embeddedservice_bootstrap.autoResponseAPI=new Ea;embeddedservice_bootstrap.userVerificationAPI=new Da;embeddedservice_bootstrap.utilAPI=new la};t.prototype.init=function(a,b,c,d){try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=c;embeddedservice_bootstrap.settings.snippetConfig=d;La(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);
if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||
!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);try{window.localStorage}catch(g){p("localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=!1}try{window.sessionStorage}catch(g){p("sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),
embeddedservice_bootstrap.isSessionStorageAvailable=!1}navigator.userAgent&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&(embeddedservice_bootstrap.isLocalStorageAvailable=!1);rb();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");window.addEventListener("message",Ma);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",Sa);Hb();embeddedservice_bootstrap.settings.hasBottomTabBar=Jb();embeddedservice_bootstrap.settings.isAuraSite=
!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=!!embeddedservice_bootstrap.settings.omitSandbox;embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;const e=Ua().then(Promise.resolve.bind(Promise),()=>Ua(B())).catch(()=>{throw Error("Error loading CSS.");
}),k=Va().then(g=>{l("init","Successfully retrieved configuration settings");La(g);g=embeddedservice_bootstrap.settings.embeddedServiceConfig;embeddedservice_bootstrap.brandingData=g&&g.branding?g.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");
if(!Object.values(x).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");m=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;Tb()},g=>{h("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((J,xa)=>{Va().then(J,xa)})}).catch(()=>{throw Error("Unable to load Embedded Messaging configuration.");});k.then(()=>{aa("ESW_3RDPARTY_STORAGE_REQUEST",
{orgId:embeddedservice_bootstrap.settings.orgId})});const f=va().then(Promise.resolve.bind(Promise),g=>Xa(g)).catch(g=>{h("init","Failed to retrieve Business Hours data.",g);throw Error("Failed to retrieve Business Hours data.");});Promise.all([e,k,f,Vb]).then(()=>{Ga();if(embeddedservice_bootstrap.isLocalStorageAvailable){var g=Object.keys(JSON.parse(localStorage.getItem(m)));l("logWebStorageItemsOnInit",`Local storage items on init: ${g}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&(g=
Object.keys(JSON.parse(sessionStorage.getItem(m))),l("logWebStorageItemsOnInit",`Session storage items on init: ${g}`));embeddedservice_bootstrap.initializeFeatureObjects();embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();if(E(r.JWT)){{C=E(r.JWT);g=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"";const J=(kb(C)||{}).channelAddId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&g!==J?embeddedservice_bootstrap.userVerificationAPI.clearSession():
(embeddedservice_bootstrap.generateMarkup(!0),Qb())}}else u()===x.UNAUTH&&embeddedservice_bootstrap.generateMarkup()})}catch(e){h("init",`Error: ${e}`)}};window.embeddedservice_bootstrap=new t})();
